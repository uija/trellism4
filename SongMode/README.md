# trellism4

# How to use it?
- Buy yourself a [Adafruit NeoTrellis M4](https://www.adafruit.com/product/4020).<br />
- _Build_ it!
- Plug the USB to something that can handle USB MIDI as it comes as a MIDI Controller (Chromatic) sending Pitchbend and Modulationwheel data that is generated by Angle-Sensors on the board
- Download the latest uf2 file from this repository. (Dateformat is YYYYMMDD)
- Plug the NeuTrellis M4 into your computer
- Double click the RESET button at the back until it is green.
- There should be a new Device connected to you computer (like an USB Stick) named TRELM4BOOT
- Copy the uf2 file there.
- Play around with the Song Mode!


# Introduction
<p>The Screens are (most of the times) devided into 3 parts</p>
<p>The first row is something like the menubar. The first button is always the play/stop button</p>
<p>The second row is for pages / banks. The Sequencer has 128 steps. 8 pages with 16 steps</p>
<p>The last 2 rows are the buttons to use. It contains the steps, the patterns etc.</p>

<h1 id="Sequence">The Sequence (Main) View</h1>
<p>This is the home view</p>
<p>Pressing the <b>Play</b> button starts the sequence (if there is at least the first step assigned). It leads to the <a href="#Play">Play-Screen</a>.</p>
<p>The <b>Init first Pattern</b> button sends a program change of the first step. See the <a href="#Midi">MIDI Section</a> below</p>
<p><b>Load</b> lets you load an existing project. Leads to the <a href="#Load">Load-Screen</a></p>
<p><b>Save</b> lets you save the current project. Leads to the <a href="#Save">Save-Screen</a></p>
<p><b>Clear</b> lets you clear the project. It deletes all Steps. Make sure to save before you do so.</p>
<p><b>Insert</b> Hold button and press a step, to insert an empty step after the step you pressed. All other steps are moved one back. If you already have 128 steps built, this will delete the last one.</p>
<p><b>Delete</b> Hold button and press a step, to delete the step you pressed. All following steps move one forward.</p>
<p>The <b>Page</b> buttons let you navigate through the pages of the sequence. Up to 8 pages apear while you fill the leading pages.</p>
<p>The Sequencer interprets an empty step as end of the sequence. If you have 1, 2, 3 and 5 filled, only 1-3 will pay.</p>
<p>The <b>Steps</b> that already have a pattern assigned are marked blue. Click any step (blue and grey) to go to the <a href="Pattern">Pattern-Screen</a>.</p>

![Sequencer Screen](https://github.com/uija/trellism4/blob/master/SongMode/img/sequencer.png?raw=true)

<h1 id="Pattern">Pattern Screen</h1>
<p>On this screen you choose, what pattern is played.</p>
<p>Pressing the <b>Play</b> button starts the sequence (if there is at least the first step assigned). It leads to the <a href="#Play">Play-Screen</a>.</p>
<p><b>Clear</b> resets the Pattern and clears the Step. Leads to the <a href="#Sequence">Sequence-Screen</a>.</p>
<p>Press and Hold the <b>Length</b> Button to acces the configuration for the Length of the pattern. Opens the <a href="#Length">Length Screen</a>.</p>
<p><b>Back</b> leads back to the <a href="#Sequence">Sequence-Screen</a>.</p>
<p>With the <b>Bank</b> and <b>Pattern</b> buttons you choose the pattern to play. The last used Pattern length is used. Leads back to the <a href="#Sequence">Sequence Screen</a>.</p>

![Pattern Screen](https://github.com/uija/trellism4/blob/master/SongMode/img/step.png?raw=true)


<h1 id="Length">Length Screen</h1>
<p>While holding the <b>Length</b> you can choose what length the pattern should have.</p>
<p>Every button is 1/4 of a bar. In the Example, it is set to 8/4 that is 2 bars.</p>
<p>Releasing the <b>Length</b> button will lead back to the <a href="#Pattern">Pattern Screen</a>.</p>

![Length Screen](https://github.com/uija/trellism4/blob/master/SongMode/img/length.png?raw=true)

<h1 id="Play">Play Screen</h1>
<p>This is visible, when the song is played.</p>
<p>The Playbutton turns red and is now a <b>Stop</b> button. Pressing it will lead back to <a href="#Sequence">Sequence screen</a>.</p>
<p>You cannot anything here but on stop</p>
<p>The currently active Page is highlighted, as well as the currently played step.</p>
<p>Empty pages and steps are not emitting any light.</p>

![Play Screen](https://github.com/uija/trellism4/blob/master/SongMode/img/play.png?raw=true)

<h1 id="Load">Load Screen</h1>
<p>Lets you choose the project to load</p>
<p>There are 8 pages of 16 projects. Empty slots are not eluminated. Filled slots are white,
  blue marks the currently active project slot.</p>
<p>Loading will reset every not saved change to the currently active project!</p>
<p>Clicking <b>Back</b> leads back to the <a href="#Sequence">Sequence Screen</a> without doing anything.</p>

![Load Screen](https://github.com/uija/trellism4/blob/master/SongMode/img/load.png?raw=true)

<h1 id="Save">Save Screen</h1>
<p>Lets you save your current project.</p>
<p>Saving to an empty slot directly saves.</p>
<p>Saving to the same slot the project was loaded from, directly saves.</p>
<p>Saving to a slot that already contains a project, will ask for permission. (Green: okay - everywhere else: cancel)</p>

![Save Screen](https://github.com/uija/trellism4/blob/master/SongMode/img/save.png?raw=true)

<h1 id="Midi">MIDI Infos / Issues</h1>
<ul>
  <li>Program-Changes need a MIDI Channel. The MIDI Channel is set to 10. I will work on a settings-page, where this can be changed.</li>
  <li>Currently I am not able to recieve MIDI. I generate a MIDI Clock and send it. This is based on the internal clock of the microcontroller. It is quite stable, but it does not send perfectly accurate clock signals.
    When set to 100bpm it sends 100.09 bpm and oscillates unregualry by +- 0.01 bpm. I have not encountered isses with that. Its just, that you have 99.9 or 100.1 on the Electron Screen.</li>
  <li>Elektron Devices need the Program Change for changing patterns slightly before the actual change occures. Currently I send the change around 1/8th to 1/16th before the pattern ends.</li>
  <li>Elektron Devices don't change directly but behave to MIDI Changes like to changes made by hand. They wait until the pattern finishs. If the length of the pattern don't match, this might cause issues, because we cannot know, if the elektron device indeed performed the change.</li>
</ul>
<h1 id="Todo">Stuff on the roadmap</h1>
<ul>
  <li>Build a Settings Menu to change the Midi Channel, Pre Delay for Pattern changes etc.</li>
  <li>Understand how MIDI in works, to be able to record pattern changes instead of programming them.</li>
</ul>
